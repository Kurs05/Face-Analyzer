{% extends 'catalog/base.html' %}

{% block content %}
{% load static %}
{% load dict_extras %}
 <div class="container">
  <h2>–î–µ—Ç–∞–ª–∏ –∞–Ω–∞–ª–∏–∑–∞</h2>

  <div class="section">
    <h3>–§–∞–π–ª</h3>
    <p><strong>–ò–º—è:</strong> {{ media.file_name }}</p>
    <p><strong>–¢–∏–ø:</strong> {{ media.get_file_type_display }}</p>
    <p><strong>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</strong> {{ media.uploaded_at|date:"Y-m-d H:i" }}</p>

    {% if media.start_file %}
      <p><strong>–ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª:</strong>
        <a href="{{ media.start_file.url }}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
      </p>
    {% endif %}
    {% if media.end_file %}
      <p><strong>–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π —Ñ–∞–π–ª:</strong>
        <a href="{{ media.end_file.url }}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
      </p>
    {% endif %}
    {% if media.landmarks_file %}
      <p><strong>–§–∞–π–ª —Å —Ä–∞–∑–º–µ—Ç–∫–æ–π:</strong>
        <a href="{{ media.landmarks_file.url }}" target="_blank">–û—Ç–∫—Ä—ã—Ç—å</a>
      </p>
    {% endif %}
  </div>

  <div class="section">
    <h3>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –ª–∏—Ü–∞ ({{ media.faces.count }})</h3>
    {% if media.faces.exists %}
      <table class="face-table">
        <thead>
          <tr>
            <th>–ò–º—è</th>
            <th>–í—Ä–µ–º—è (–µ—Å–ª–∏ –≤–∏–¥–µ–æ)</th>
            <th>–ü–æ–ª</th>
            <th>–í–æ–∑—Ä–∞—Å—Ç</th>
            <th>–¢–æ–ø —ç–º–æ—Ü–∏—è</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for face in media.faces.all %}
            {% with face_data=face.data %}
              <tr>
                <td>{{ face.name }}</td>
                <td>{% if face.timestamp %}{{ face.timestamp }} c{% else %}‚Äî{% endif %}</td>
                <td>{{ face_data.dominant_gender }}</td>
                <td>{{ face_data.age }}</td>
                <td>{{ face_data.dominant_emotion }} ({{ face_data.emotion|get_item:face_data.dominant_emotion }}%)</td>
                <td>
                  <button class="details-btn" onclick="showDetails({{ face.pk }})">üîç Details</button>
                </td>
              </tr>
              <tr id="details-{{ face.pk }}" style="display:none;">
                  <td colspan="6">
                    <div class="details-columns">
                      <div class="column">
                        <h4>–≠–º–æ—Ü–∏–∏:</h4>
                        {% for emotion, val in face_data.emotion.items %}
                          <div><strong>{{ emotion }}</strong>: {{ val }}%</div>
                        {% endfor %}
                      </div>

                      <div class="column">
                        <h4>–†–∞—Å–∞:</h4>
                        <p><strong>–¢–æ–ø:</strong> {{ face_data.dominant_race }}</p>
                        {% for race, val in face_data.race.items %}
                          <div><strong>{{ race }}</strong>: {{ val }}%</div>
                        {% endfor %}
                      </div>
                    </div>
                  </td>
                </tr>


            {% endwith %}
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>–õ–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p>
    {% endif %}
  </div>
</div>

<script>
  function showDetails(id) {
    const row = document.getElementById('details-' + id);
    row.style.display = (row.style.display === 'none') ? 'table-row' : 'none';
  }
</script>
{% endblock %}